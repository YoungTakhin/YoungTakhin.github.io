{"title":"MyBatis框架入门六. MyBatis动态SQL语句","date":"2019-11-19T07:22:51.000Z","date_formatted":{"ll":"2019年11月19日","L":"2019/11/19","MM-DD":"11-19"},"color":"#EBF8FF","link":"articles/29950","comments":true,"tags":["Java","MyBatis"],"categories":["MyBatis框架入门"],"updated":"2019-12-20T08:17:40.365Z","content":"<h1 id=\"MyBatis框架入门六-MyBatis动态SQL语句\">MyBatis框架入门六. MyBatis动态SQL语句<a href=\"articles/29950#MyBatis框架入门六-MyBatis动态SQL语句\"></a></h1><h2 id=\"if标签\">if标签<a href=\"articles/29950#if标签\"></a></h2><ol>\n<li><p>在dao接口中添加方法</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 根据输入参数条件查询用户</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> user 查询的条件，有可能有用户名、性别、地址等条件</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\">List&lt;User&gt; <span class=\"title\">findByCondition</span><span class=\"params\">(User user)</span></span>;</span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>在映射配置文件中添加配置</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 根据输入参数条件查询用户--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findByCondition\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.ydx.domain.User\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.ydx.domain.User\"</span>&gt;</span></span><br><span class=\"line\">    SELECT * FROM user WHERE 1 = 1</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"username != null\"</span>&gt;</span></span><br><span class=\"line\">        AND username LIKE #&#123;username&#125;;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>在测试类中添加测试方法</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 测试根据输入参数条件查询用户</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testFindByCondition</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    user.setUsername(<span class=\"string\">\"老王\"</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//执行根据输入参数条件查询用户</span></span><br><span class=\"line\">    List&lt;User&gt; users = userDao.findByCondition(user);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (User u : users) &#123;</span><br><span class=\"line\">        System.out.println(u);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n</li>\n</ol>\n<h2 id=\"where标签\">where标签<a href=\"articles/29950#where标签\"></a></h2><ol>\n<li><p>在映射配置文件中修改配置</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 根据输入参数条件查询用户--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findByCondition\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.ydx.domain.User\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.ydx.domain.User\"</span>&gt;</span></span><br><span class=\"line\">    SELECT * FROM user</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"username != null\"</span>&gt;</span></span><br><span class=\"line\">            AND username LIKE #&#123;username&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"sex != null\"</span>&gt;</span></span><br><span class=\"line\">            AND sex LIKE #&#123;sex&#125;;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>在测试类中修改测试方法</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 测试根据输入参数条件查询用户</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testFindByCondition</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    user.setUsername(<span class=\"string\">\"老王\"</span>);</span><br><span class=\"line\">    user.setSex(<span class=\"string\">\"女\"</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"comment\">//执行根据输入参数条件查询用户</span></span><br><span class=\"line\">    List&lt;User&gt; users = userDao.findByCondition(user);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (User u : users) &#123;</span><br><span class=\"line\">        System.out.println(u);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n</li>\n</ol>\n<h2 id=\"foreach标签\">foreach标签<a href=\"articles/29950#foreach标签\"></a></h2><ol>\n<li><p>利用QueryVo，添加属性ids表示用户的id集合，并生成get、set方法</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> List&lt;Integer&gt; ids; </span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;Integer&gt; <span class=\"title\">getIds</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ids;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setIds</span><span class=\"params\">(List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.ids = ids;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>在dao接口中添加方法</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 根据QueryVo中提供的用户id查询用户</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> vo</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\">List&lt;User&gt; <span class=\"title\">findByIds</span><span class=\"params\">(QueryVo vo)</span></span>;</span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>在映射配置文件中添加配置</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 根据QueryVo中提供的用户id查询用户--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findInIds\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.ydx.domain.QueryVo\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.ydx.domain.User\"</span>&gt;</span></span><br><span class=\"line\">    SELECT * FROM user</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"ids != null and ids.size() &gt; 0\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"ids\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"id IN (\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"uid\"</span> <span class=\"attr\">separator</span>=<span class=\"string\">\", \"</span>&gt;</span></span><br><span class=\"line\">                #&#123;uid&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>在测试类中添加测试方法</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 测试根据QueryVo中提供的用户id查询用户</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testFindInIds</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    QueryVo vo = <span class=\"keyword\">new</span> QueryVo();</span><br><span class=\"line\">    List&lt;Integer&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;Integer&gt;();</span><br><span class=\"line\">    list.add(<span class=\"number\">41</span>);</span><br><span class=\"line\">    list.add(<span class=\"number\">42</span>);</span><br><span class=\"line\">    list.add(<span class=\"number\">43</span>);</span><br><span class=\"line\">    vo.setIds(list);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//执行根据QueryVo中提供的用户id查询用户</span></span><br><span class=\"line\">    List&lt;User&gt; users = userDao.findInIds(vo);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (User user : users) &#123;</span><br><span class=\"line\">        System.out.println(user);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n</li>\n</ol>\n<h2 id=\"sql标签与include标签\">sql标签与include标签<a href=\"articles/29950#sql标签与include标签\"></a></h2><p>sql标签和include标签可以抽取重复的SQL语句。</p>\n<ol>\n<li><p>在映射配置文件中添加配置</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 抽取重复的SQL语句--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sql</span> <span class=\"attr\">id</span>=<span class=\"string\">\"defaultTable\"</span>&gt;</span></span><br><span class=\"line\">    SELECT * FROM user</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sql</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>修改其他配置</p>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 根据QueryVo中提供的用户id查询用户--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findInIds\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.ydx.domain.QueryVo\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.ydx.domain.User\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">include</span> <span class=\"attr\">refid</span>=<span class=\"string\">\"defaultTable\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"ids != null and ids.size() &gt; 0\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"ids\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"id IN (\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"uid\"</span> <span class=\"attr\">separator</span>=<span class=\"string\">\", \"</span>&gt;</span></span><br><span class=\"line\">                #&#123;uid&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n</li>\n</ol>\n","prev":{"title":"Spring框架入门一. Spring概述","link":"articles/26865"},"next":{"title":"MyBatis框架入门五. MyBatis事务","link":"articles/61215"},"plink":"http://alpac.top/articles/29950/","toc":[{"title":"MyBatis框架入门六. MyBatis动态SQL语句","id":"MyBatis框架入门六-MyBatis动态SQL语句","index":"1","children":[{"title":"if标签","id":"if标签","index":"1.1"},{"title":"where标签","id":"where标签","index":"1.2"},{"title":"foreach标签","id":"foreach标签","index":"1.3"},{"title":"sql标签与include标签","id":"sql标签与include标签","index":"1.4"}]}],"reward":true,"copyright":{"author":"Yang Dexuan","link":"<a href=\"http://alpac.top/articles/29950/\" title=\"MyBatis框架入门六. MyBatis动态SQL语句\">http://alpac.top/articles/29950/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}