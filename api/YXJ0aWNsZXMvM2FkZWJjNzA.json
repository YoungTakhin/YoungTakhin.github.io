{"title":"Spring框架入门6 Spring基于注解开发的配置","date":"2019-12-25T06:17:14.000Z","date_formatted":{"ll":"2019年12月25日","L":"2019/12/25","MM-DD":"12-25"},"color":"#EBF8FF","link":"articles/3adebc70","comments":true,"tags":["Java","Spring"],"categories":["Spring框架入门"],"updated":"2019-12-25T08:15:36.101Z","content":"<h1 id=\"Spring框架入门6-Spring基于注解开发的配置\">Spring框架入门6 Spring基于注解开发的配置<a href=\"articles/3adebc70#Spring框架入门6-Spring基于注解开发的配置\"></a></h1><h2 id=\"使用XML配置\">使用XML配置<a href=\"articles/3adebc70#使用XML配置\"></a></h2><ol>\n<li><p>修改 Spring 上下文配置</p>\n<figure class=\"highlight\"><figcaption><span>applicationContext.xml</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        http://www.springframework.org/schema/context</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        https://www.springframework.org/schema/context/spring-context.xsd\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 开启注解（声明了context:component-scan时，可省略） --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 告知Spring在创建容器时要扫描的包 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.ydx\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--配置QueryRunner --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"runner\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.apache.commons.dbutils.QueryRunner\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"prototype\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--注入数据源 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">name</span>=<span class=\"string\">\"ds\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 加载properties文件 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 配置数据源 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 连接数据库的必备信息 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driver&#125;\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>基于注解的装配与注入</p>\n<ul>\n<li><p>与创建对象有关的注解：</p>\n<ul>\n<li><p><code>@Component</code> 注解标记在类上，当使用了基于注解的配置和类路径扫描时，会把当前类对象作为 bean 存入 Spring IoC 容器中。</p>\n<ul>\n<li>属性 <code>value</code> 用于指定 bean id，默认值为类名首字母大写转小写。</li>\n</ul>\n</li>\n</ul>\n<p>与 <code>@Component</code> 注解的功能完全等同的注解还有以下三种：</p>\n<ul>\n<li><code>@Repository</code>：通常标记在持久层类上。</li>\n<li><code>@Service</code>：通常标记在业务层类上。</li>\n<li><code>@Controller</code>：通常标记在表现层类上。</li>\n</ul>\n</li>\n<li><p>与注入数据有关的注解：</p>\n<blockquote>\n<p>使用注解注入时，类的 set 方法可省略</p>\n</blockquote>\n<ul>\n<li><code>@Autowired</code>：<code>@Autowired</code> 注解可以标记在方法、构造方法、形参、属性、注解上，默认情况下，该注解以 byType 方式注入，若有多个 bean， 则又以 byName 方式注入，若还有多个 bean 则抛出异常。</li>\n<li><code>@Qualifier</code>：<code>@Qualifier</code> 注解可以标记在属性、方法、形参、类、注解上，一般与 <code>@Autowired</code> 注解一起使用，在自动类型注入基础上，再按照 Bean id 注入。</li>\n</ul>\n</li>\n</ul>\n<p>使用以上注解修改 service 和 dao 层的实现类：</p>\n<figure class=\"highlight\"><figcaption><span>accountServiceImpl.java</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ydx.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.dao.AccountDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.domain.Account;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.service.AccountService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span>(<span class=\"string\">\"accountService\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AccountServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">AccountService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span> <span class=\"comment\">//自动注入</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> AccountDao accountDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Account&gt; <span class=\"title\">findAllAccount</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> accountDao.findAllAccount();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight\"><figcaption><span>accountDaoImpl.java</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ydx.dao.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.dao.AccountDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.domain.Account;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Repository;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 账户的持久层实现类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Repository</span>(<span class=\"string\">\"accountDao\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AccountDaoImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">AccountDao</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span> <span class=\"comment\">//自动注入</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> QueryRunner runner;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Account&gt; <span class=\"title\">findAllAccount</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> runner.query(<span class=\"string\">\"select * from account\"</span>, <span class=\"keyword\">new</span> BeanListHandler&lt;Account&gt;(Account.class));</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n\n</li>\n</ol>\n<h2 id=\"使用Java配置类配置\">使用Java配置类配置<a href=\"articles/3adebc70#使用Java配置类配置\"></a></h2>","next":{"title":"Spring框架入门5. 基于XML的IoC案例","link":"articles/7423130"},"plink":"http://alpac.top/articles/3adebc70/","toc":[{"title":"Spring框架入门6 Spring基于注解开发的配置","id":"Spring框架入门6-Spring基于注解开发的配置","index":"1","children":[{"title":"使用XML配置","id":"使用XML配置","index":"1.1"},{"title":"使用Java配置类配置","id":"使用Java配置类配置","index":"1.2"}]}],"reward":true,"copyright":{"author":"Yang Dexuan","link":"<a href=\"http://alpac.top/articles/3adebc70/\" title=\"Spring框架入门6 Spring基于注解开发的配置\">http://alpac.top/articles/3adebc70/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}