{"title":"Spring框架入门6 Spring基于注解开发的配置","date":"2019-12-25T06:17:14.000Z","date_formatted":{"ll":"2019年12月25日","L":"2019/12/25","MM-DD":"12-25"},"color":"#EBF8FF","link":"articles/3adebc70","comments":true,"tags":["Java","Spring"],"categories":["Spring框架入门"],"updated":"2019-12-26T16:01:38.536Z","content":"<h1 id=\"Spring框架入门6-Spring基于注解开发的配置\">Spring框架入门6 Spring基于注解开发的配置<a href=\"articles/3adebc70#Spring框架入门6-Spring基于注解开发的配置\"></a></h1><h2 id=\"使用XML配置\">使用XML配置<a href=\"articles/3adebc70#使用XML配置\"></a></h2><p>基于上一案例修改</p>\n<ol>\n<li><p>修改 Spring 上下文配置</p>\n<figure class=\"highlight\"><figcaption><span>applicationContext.xml</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        http://www.springframework.org/schema/context</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        https://www.springframework.org/schema/context/spring-context.xsd\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 开启注解（声明了context:component-scan时，可省略） --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 告知Spring在创建容器时要扫描的包 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.ydx\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--配置QueryRunner --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"runner\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.apache.commons.dbutils.QueryRunner\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"prototype\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--注入数据源 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">name</span>=<span class=\"string\">\"ds\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 加载properties文件 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 配置数据源 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 连接数据库的必备信息 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driver&#125;\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>基于注解的装配与注入</p>\n<ul>\n<li><p>与创建对象有关的注解：</p>\n<ul>\n<li><p><code>@Component</code> 注解标记在类上，当使用了基于注解的配置和类路径扫描时，会把当前类对象作为 bean 存入 Spring IoC 容器中。</p>\n<ul>\n<li>属性 <code>value</code> 用于指定 bean id，默认值为类名首字母大写转小写。</li>\n</ul>\n</li>\n</ul>\n<p>与 <code>@Component</code> 注解的功能完全等同的注解还有以下三种：</p>\n<ul>\n<li><code>@Repository</code>：通常标记在持久层类上。</li>\n<li><code>@Service</code>：通常标记在业务层类上。</li>\n<li><code>@Controller</code>：通常标记在表现层类上。</li>\n</ul>\n</li>\n<li><p>与注入数据有关的注解：</p>\n<blockquote>\n<p>使用注解注入时，类的 set 方法可省略</p>\n</blockquote>\n<ul>\n<li><code>@Value</code>：<code>@Value</code> 注解可以标记在类、方法、形参、注解上，用于注入基本类型和 String 类型，还支持 Spring 的 EL 表达式。</li>\n<li><code>@Autowired</code>：<code>@Autowired</code> 注解可以标记在方法、构造方法、形参、属性、注解上，默认情况下，该注解以 byType 方式注入，若有多个 bean， 则又以 byName 方式注入，若还有多个 bean 则抛出异常。</li>\n<li><code>@Qualifier</code>：<code>@Qualifier</code> 注解可以标记在属性、方法、形参、类、注解上，一般与 <code>@Autowired</code> 注解一起使用，在自动类型注入基础上，再按照 Bean id 注入。</li>\n</ul>\n</li>\n</ul>\n<p>使用以上注解修改 service 和 dao 层的实现类：</p>\n<figure class=\"highlight\"><figcaption><span>accountServiceImpl.java</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ydx.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.dao.AccountDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.domain.Account;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.service.AccountService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span>(<span class=\"string\">\"accountService\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AccountServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">AccountService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span> <span class=\"comment\">//自动注入</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> AccountDao accountDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Account&gt; <span class=\"title\">findAllAccount</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> accountDao.findAllAccount();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight\"><figcaption><span>accountDaoImpl.java</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ydx.dao.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.dao.AccountDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.domain.Account;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Repository;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 账户的持久层实现类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Repository</span>(<span class=\"string\">\"accountDao\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AccountDaoImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">AccountDao</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span> <span class=\"comment\">//自动注入</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> QueryRunner runner;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Account&gt; <span class=\"title\">findAllAccount</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> runner.query(<span class=\"string\">\"select * from account\"</span>, <span class=\"keyword\">new</span> BeanListHandler&lt;&gt;(Account.class));</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n\n</li>\n</ol>\n<h2 id=\"使用Java配置类配置\">使用Java配置类配置<a href=\"articles/3adebc70#使用Java配置类配置\"></a></h2><p>基于上一案例修改</p>\n<ol>\n<li><p>新建包 config 作为配置包</p>\n</li>\n<li><p>新建配置类：</p>\n<ul>\n<li>与上下文有关的注解：<ul>\n<li><code>@Configuration</code>：<code>@Configuration</code> 注解标记在类上，用于指定当前类为主配置类，当配置类作为 <code>AnnotationConfigApplicationContext</code> 对象创建的参数时，该注释可省略。</li>\n<li><code>@ComponentScan</code>：<code>@ComponentScan</code> 注解标记在类上，用于指定 Spring 在创建时要扫描的包。<ul>\n<li>属性 <code>value</code> 指定包的类路径。</li>\n</ul>\n</li>\n<li><code>@ComponentScans</code>：可以扫描多个包的类路径，同 <code>@ComponentScan</code> 注解。</li>\n<li><code>@Bean</code>：<code>@Bean</code> 注解标记在方法、注解上，用于把当前方法的返回值当作 bean 对象存入 Spring IoC 容器中。<ul>\n<li>属性 <code>value</code> 指定 bean id，默认值为被标记的方法名。</li>\n</ul>\n</li>\n<li><code>@Import</code>：<code>@Import</code>注解标记在类上，用于导入其他配置类。<ul>\n<li>属性 <code>value</code> 指定其他配置类的字节码。</li>\n</ul>\n</li>\n<li><code>@PropertySource</code>：<code>@PropertySource</code> 注解标记在类上，用于读取 resouces 下的 properties 文件。<ul>\n<li>属性 <code>value</code> 格式为”classpath:文件名.properties”。</li>\n</ul>\n</li>\n<li><code>@PropertySources</code>：可以读取多个 properties 文件，同 <code>@PropertySource</code> 注解。</li>\n</ul>\n</li>\n<li>与作用域及生命周期有关的注解：<ul>\n<li><code>@Scope</code>：<code>@Scope</code> 注解标记在类、方法上，用于指定 bean 的作用域。<ul>\n<li>属性 <code>value</code> 取值同 <code>&lt;bean&gt;</code> 中的 <code>scope</code> 属性。</li>\n</ul>\n</li>\n<li><code>@PostConstruct</code>：<code>@PostConstruct</code> 注解标记在方法上，声明该方法在 bean 创建时立即执行。</li>\n<li><code>@PreDestroy</code>：<code>@PreDestroy</code>  注解标记在方法上，声明该方法在 bean 销毁时执行。</li>\n</ul>\n</li>\n</ul>\n<p>使用上述标签新建主配置类 SpringConfig.java</p>\n<figure class=\"highlight\"><figcaption><span>SpringConfig.java</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Import;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Spring配置类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span> <span class=\"comment\">//指定当前类为主配置类，作为AnnotationConfigApplicationContext的参数时可省略</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan</span>(<span class=\"string\">\"com.ydx\"</span>) <span class=\"comment\">//指定Spring创建是要扫描的包</span></span><br><span class=\"line\"><span class=\"meta\">@Import</span>(JdbcConfig.class) <span class=\"comment\">//要导入的其他配置文件</span></span><br><span class=\"line\"><span class=\"meta\">@PropertySource</span>(<span class=\"string\">\"classpath:jdbc.properties\"</span>) <span class=\"comment\">//指定properties文件位置</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringConfig</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n\n<p>新建 JDBC 配置类 JdbcConfig.java</p>\n<figure class=\"highlight\"><figcaption><span>JdbcConfig.java</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Scope;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.sql.DataSource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * JDBC配置类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JdbcConfig</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;jdbc.driver&#125;\"</span>) <span class=\"comment\">//从properties文件注入数据</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String driver;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String url;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 加载数据源</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span> <span class=\"comment\">//创建了名字为dataSource的bean，存入IoC容器</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">dataSource</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            ComboPooledDataSource ds = <span class=\"keyword\">new</span> ComboPooledDataSource();</span><br><span class=\"line\">            ds.setDriverClass(driver);</span><br><span class=\"line\">            ds.setJdbcUrl(url);</span><br><span class=\"line\">            ds.setUser(username);</span><br><span class=\"line\">            ds.setPassword(password);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ds;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建QueryRunner对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> dataSource</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span>(name = <span class=\"string\">\"qr\"</span>) <span class=\"comment\">//Spring创建了一个名字叫qr的bean，存入IoC容器</span></span><br><span class=\"line\">    <span class=\"meta\">@Scope</span>(<span class=\"string\">\"prototype\"</span>) <span class=\"comment\">//多例对象</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> QueryRunner <span class=\"title\">queryRunner</span><span class=\"params\">(@Qualifier(<span class=\"string\">\"dataSource\"</span>)</span> <span class=\"comment\">//指定bean id注入</span></span></span><br><span class=\"line\"><span class=\"function\">                                               DataSource dataSource) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> QueryRunner(dataSource);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>修改测试类</p>\n<figure class=\"highlight\"><figcaption><span>JdbcConfig.java</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ydx;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.domain.Account;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ydx.service.AccountService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> config.SpringConfig;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取Spring的IoC核心容器，并根据id获取对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//获取核心容器对象，这里使用了AnnotationConfigApplicationContext</span></span><br><span class=\"line\">        AnnotationConfigApplicationContext ac = <span class=\"keyword\">new</span> AnnotationConfigApplicationContext(SpringConfig.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//根据id获取bean对象</span></span><br><span class=\"line\">        AccountService as = ac.getBean(<span class=\"string\">\"accountService\"</span>, AccountService.class);</span><br><span class=\"line\">        List&lt;Account&gt; accounts = as.findAllAccount();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(Account account : accounts) &#123;</span><br><span class=\"line\">            System.out.println(account);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br></pre></td></tr></table></div></figure>\n</li>\n</ol>\n","next":{"title":"Spring框架入门5. 基于XML的IoC案例","link":"articles/7423130"},"plink":"http://alpac.top/articles/3adebc70/","toc":[{"title":"Spring框架入门6 Spring基于注解开发的配置","id":"Spring框架入门6-Spring基于注解开发的配置","index":"1","children":[{"title":"使用XML配置","id":"使用XML配置","index":"1.1"},{"title":"使用Java配置类配置","id":"使用Java配置类配置","index":"1.2"}]}],"reward":true,"copyright":{"author":"Yang Dexuan","link":"<a href=\"http://alpac.top/articles/3adebc70/\" title=\"Spring框架入门6 Spring基于注解开发的配置\">http://alpac.top/articles/3adebc70/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}